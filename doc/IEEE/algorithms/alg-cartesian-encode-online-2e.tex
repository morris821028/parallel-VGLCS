\begin{algorithm}[!thb]
\SetAlgoNoLine
\KwIn{
  $S$: state of Cartesian Tree;  $v$: the added data;
  $D$: A stack where every element has $s$, $t$, and $v$ \;
}
\KwOut{
  $t$: The Catalan index of the input data block after adding $v$
}

$p \gets S.p$, $s \gets 0$, $t \gets 0$ \;
$s' \gets S.s - S.{i} + 1$ \;
$t' \gets C[s'] - 1$ \;

\While{$D[p].{value} < v$} {
  $t \gets t(D[p].s, D[p].t, s, t)$ \;
  $t' \gets t(D[p].s, D[p].t, s', t')$ \;
  $s \gets s + D[p].s+1$ \;
  $s' \gets s' + D[p].s+1$ \;
  $p \gets p - 1$ \;
}
$p \gets p + 1$ \;
$D[p] \gets \left \langle s, t, {v} \right \rangle$ \;
$S.p \gets p$ \;
$x.t \gets t(s, t, S.s-S.i, C[S.s-S.i]-1)$ \;
$S.t \gets S.t + t' - x.t$ \;
$S.i \gets S.i + 1$ \;
return $S.t$ \;

  \caption{Online Type of Cartesian Tree}
  \label{alg:cartesian-encode-online}
\end{algorithm}
