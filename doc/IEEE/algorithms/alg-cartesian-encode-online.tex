\begin{algorithm}[!thb]
  \caption{Online Type of Cartesian Tree}
  \label{alg:cartesian-encode-online}
  \begin{algorithmic}[1]
  \Require
      $\mathit{state}$: state of Cartesian Tree;
      $v$: the value which append to array
  \Ensure
      $\mathit{tid}$: this label
  \State $\textit{Dp} \gets \textit{state}.\textit{Dp}$, $\textit{lsz} \gets 0$, $\textit{lid} \gets 0$
  \State $\textit{bsz} \gets \textit{state}.\textit{s} - \textit{state}.\textit{i} + 1$
  \State $\textit{bid} \gets C[\textit{bsz}] - 1$
  \While{$\textit{state}.D[\textit{Dp}].\textit{value} < v$}
    \State $\textit{lid} \gets \textit{tid}(\textit{state}.D[\textit{Dp}].\textit{lsz}, \textit{state}.D[\textit{Dp}].\textit{lid}, \textit{lsz}, \textit{lid})$
    \State $\textit{bid} \gets \textit{tid}(\textit{state}.D[\textit{Dp}].\textit{lsz}, \textit{state}.D[\textit{Dp}].\textit{lid}, \textit{bsz}, \textit{bid})$
    \State $\textit{lsz} \gets \textit{lsz} + \textit{state}.D[\textit{Dp}].\textit{lsz}+1$
    \State $\textit{bsz} \gets \textit{bsz} + \textit{state}.D[\textit{Dp}].\textit{lsz}+1$
    \State $\textit{Dp} \gets \textit{Dp} - 1$
  \EndWhile
  \State $\textit{Dp} \gets \textit{Dp} + 1$
  \State $\textit{state}.D[\textit{Dp}] \gets \left \langle \textit{lsz}, \textit{lid}, \textit{v} \right \rangle$
  \State $\textit{state}.\textit{Dp} \gets \textit{Dp}$
  \State $x.\textit{tid} \gets \textit{tid}(\textit{lsz}, \textit{lid}, \textit{state}.s-\textit{state}.i, C[\textit{state}.s-\textit{state}.i]-1)$
  \State $\textit{state}.\textit{tid} \gets \textit{state}.\textit{tid} + \textit{bid} - x.\textit{tid}$
  \State $\textit{state}.i \gets \textit{state}.i + 1$
  \State return $\textit{state}.\textit{tid}$
  \end{algorithmic}
\end{algorithm}