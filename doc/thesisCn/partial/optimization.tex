\section{實作細節}
\label{sec:Implementation}

\subsection{平行并查集操作策略}

運行 VGLCS 時，將耗費 $\theta(n^2)$ 的內存空間。使用遞增後綴最大值 (ISMQ) 時，採用並查集實作將會遭遇到很多不平衡的工作負載，其原因在於合併的策略，常見的有路徑壓縮和啟發式合併兩種策略，這間接影響到不同次數的分枝判斷。實務上須考慮到快取未中，故兩種策略只能擇其一，兩者皆用將引發更多的快取未中而導致效能下滑。

每個執行緒負責數個完整的并查集，操作時應偏向延遲標記操作，儘早合併的策略易造成快取未中。由於動態規劃的傾向中，插入值的趨勢有兩種情況，其一為連續不合定義的零元素插入，其二為遞增元素的插入，在這兩者穿插的趨勢中，我們發現延遲操作將會帶來較能改善快取未中問題。

\subsection{平行區間查找策略}

運行區間查找時，一般依賴內建函數在 $O(1)$ 時間完成對數取整，然而，在 VGLCS 這類型的動態規劃中，區間查找的對數結果是可以被預測的，預先將每一組詢問的區段對數結果儲存在陣列中，便可降低指令次數。

由於已知所有詢問區間，建立稀疏表時，可藉由動態規劃在 $O(n \log n)$ 排除掉不可能的計算 (參照算法 ~\ref{alg:reduce-boundary})，降低過程中的計算量。由於 VGLCS 在平行操作需要 $O(n \log n)$，故使用動態規劃不影響我們的最終結果。

\input{algorithms/alg-reduce-boundary}

從機率分佈的角度來看，因 $s = \frac{1}{4} \log n$ 過小，區間詢問完全落於 block 的機率低，故額外維護區段前綴和後綴最大值 (prefix/suffix maximum value in block) 取代笛卡爾樹的建立。藉這兩個額外儲存空間，將會增加空間複雜度的常數，卻能有效地降低整體的指令次數。